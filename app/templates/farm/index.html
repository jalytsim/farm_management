{% extends 'layout.html' %}

{% block content %}
    <h1 class="text-4xl font-bold mb-8 text-center">Farm Management</h1>

    <div class="flex justify-between mb-8">
        <a href="{{ url_for('points.create_point_route') }}">create point</a>
        <button onclick="openModal('farmModal')" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Farm</button>
        <button onclick="openModal('farmerGroupModal')" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Farmer Group</button>
        <button onclick="openModal('cropModal')" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Create Crop</button>
    </div>

    {% include 'farm/farm_list.html' %}
    {% include 'farm/_farm_form_modal.html' %}
    {% include 'farmergroup/_farmergroup_form_modal.html' %}
    {% include 'crop/_crop_form_modal.html' %}

    <script>
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function updateFarm(farmId) {
            const name = document.querySelector(`.farm-name[data-id='${farmId}']`).value;
            const district_id = document.querySelector(`.farm-district[data-id='${farmId}']`).value;
            const farmergroup_id = document.querySelector(`.farm-farmergroup[data-id='${farmId}']`).value;
            const longitude = document.querySelector(`.farm-longitude[data-id='${farmId}']`).value;
            const latitude = document.querySelector(`.farm-latitude[data-id='${farmId}']`).value;
            const geolocation = `${longitude},${latitude}`;

            fetch(`/farm/${farmId}/update`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: name,
                    district_id: district_id,
                    farmergroup_id: farmergroup_id,
                    geolocation: geolocation
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Farm updated successfully');
                } else {
                    alert('Error updating farm');
                }
            });
        }

        // Fonctions pour ouvrir les modals depuis la sidebar
        function openCreateCropModal() {
            openModal('cropModal');
        }

        function openCreateDistrictModal() {
            openModal('districtModal');
        }

        function openCreateFarmerGroupModal() {
            openModal('farmerGroupModal');
        }

        function openCreatePointModal() {
            openModal('pointModal');
        }

        function openCreateFarmModal() {
            openModal('farmModal');
        }
    </script>
{% endblock %}
